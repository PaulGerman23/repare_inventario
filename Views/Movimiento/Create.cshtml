@model inventario_coprotab.ViewModels.MovimientoViewModel
@{
    ViewData["Title"] = "Registrar Movimiento";
}

<h2>@ViewData["Title"]</h2>

<form asp-action="Create">
    <div class="form-group">
        <label asp-for="IdDispositivo"></label>
        <select asp-for="IdDispositivo" class="form-control" onchange="actualizarInfo()">
            <option value="">-- Seleccionar dispositivo --</option>
            @foreach (var disp in ViewBag.Dispositivos)
            {
                <option value="@disp.IdDispositivo"
                        data-nombre="@disp.Nombre"
                        data-tipo="@disp.IdTipoNavigation?.Descripcion"
                        data-marca="@disp.IdMarcaNavigation?.Nombre"
                        data-stock="@disp.StockActual"
                        data-minimo="@disp.StockMinimo">
                    @disp.Nombre - @disp.IdMarcaNavigation?.Nombre (@disp.StockActual en stock)
                </option>
            }
        </select>
        <span asp-validation-for="IdDispositivo" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="TipoMovimiento"></label>
        <select asp-for="TipoMovimiento" class="form-control">
            <option value="">-- Seleccionar tipo --</option>
            <option value="Entrada">Entrada (Compra)</option>
            <option value="Salida">Salida (Uso)</option>
            <option value="Traslado">Traslado</option>
            <option value="Baja">Baja</option>
        </select>
        <span asp-validation-for="TipoMovimiento" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Cantidad"></label>
        <input asp-for="Cantidad" class="form-control" />
        <span asp-validation-for="Cantidad" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="IdUbicacion"></label>
        <select asp-for="IdUbicacion" class="form-control">
            <option value="">-- Sin ubicación --</option>
            @foreach (var ubi in ViewBag.Ubicaciones)
            {
                <option value="@ubi.IdUbicacion">@ubi.Nombre</option>
            }
        </select>
    </div>

    <div class="form-group">
        <label asp-for="IdResponsable"></label>
        <select asp-for="IdResponsable" class="form-control">
            <option value="">-- Sin responsable --</option>
            @foreach (var resp in ViewBag.Responsables)
            {
                <option value="@resp.IdResponsable">@resp.Nombre @resp.Apellido</option>
            }
        </select>
    </div>

    <div class="form-group">
        <label asp-for="Observaciones"></label>
        <textarea asp-for="Observaciones" class="form-control"></textarea>
    </div>

    <div id="info-dispositivo" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border: 1px solid #ddd; display: none;">
        <h5>Información del dispositivo seleccionado:</h5>
        <p><strong>Nombre:</strong> <span id="nombre-disp"></span></p>
        <p><strong>Tipo:</strong> <span id="tipo-disp"></span></p>
        <p><strong>Marca:</strong> <span id="marca-disp"></span></p>
        <p><strong>Stock actual:</strong> <span id="stock-disp"></span></p>
        <p><strong>Stock mínimo:</strong> <span id="minimo-disp"></span></p>
    </div>

    <button type="submit" class="btn btn-primary">Guardar</button>
    <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
</form>

@section Scripts {
    <script>
        function actualizarInfo() {
            var select = document.getElementById('IdDispositivo');
            var selected = select.options[select.selectedIndex];
            if (selected.value) {
                document.getElementById('nombre-disp').innerText = selected.getAttribute('data-nombre');
                document.getElementById('tipo-disp').innerText = selected.getAttribute('data-tipo') || 'N/A';
                document.getElementById('marca-disp').innerText = selected.getAttribute('data-marca') || 'N/A';
                document.getElementById('stock-disp').innerText = selected.getAttribute('data-stock');
                document.getElementById('minimo-disp').innerText = selected.getAttribute('data-minimo');
                document.getElementById('info-dispositivo').style.display = 'block';
            } else {
                document.getElementById('info-dispositivo').style.display = 'none';
            }
        }
    </script>
}